<session-header></session-header>
<div class="page-editor shuttle">
  @if (manager.dayHasCalendarItems$|async) {
    @if (manager.isLoadingSod$|async) {
      <div class="empty-container">loading...</div>
    } @else {
      <!-- chi c'è -->
      <div class="persons-list">
        @if (passengersMap$|async; as psgMap) {
          @for (psg of passengers$|async; track $index) {
            <div class="person-selector"
                 fxLayout="row" fxLayoutAlign="start center"
                 (click)="togglePassenger(psg)"
                 [class.present]="psgMap[psg.code]==='p'"
                 [class.absent]="psgMap[psg.code]==='a'"
                 [class.ready]="psgMap[psg.code]==='r'"
                 [class.unknown]="!psgMap[psg.code]">
              <span class="text">{{psg.name}}</span>
              @if (manager.sessionOnDay$|async|activeDirections:psg; as directions) {
                <mat-icon>{{ICON_BY_DIRECTIONS[directions]}}</mat-icon>
              } @else {
                <mat-icon>{{ICON_BY_CODE[psgMap[psg.code]]||UNKNOWN_ICON}}</mat-icon>
              }
              @if (psg.group) {
                <div class="passenger-group">{{psg.group|groupName:manager.session}}</div>
              }
            </div>
          }
        }
        <div class="passenger-add"
             fxLayout="row" fxLayoutAlign="center center"
             matTooltip="add new passenger"
             (click)="addPassenger()">
          <mat-icon>person_add</mat-icon>
        </div>
      </div>

      <!-- calendario attività -->
      <session-calendar></session-calendar>

      <!-- navette necessarie A/R -->
      <div class="shuttles">
        <div class="shuttles-container" [fxLayout]="shuttlesLayout$|async">
          <div class="shuttles-column" fxLayout="column" fxFlex>
            <div class="shuttle-column-header" fxLayout="column">
              <div class="direction" [class.ready]="manager.sessionOnDay$|async|isReadyDirection:'A'" spb-i18n>{{KEYS._session_to_destination}}</div>
              <shuttle-errors direction="A"></shuttle-errors>
            </div>
            @for (shA of shuttles$|async|shuttleType:'A'; track $index) {
              <shuttle-editor [shuttle]="shA"></shuttle-editor>
            }
          </div>
          <div class="shuttles-column spb-background-ghost" fxLayout="column" fxFlex>
            <div class="shuttle-column-header" fxLayout="column">
              <div class="direction" [class.ready]="manager.sessionOnDay$|async|isReadyDirection:'R'" spb-i18n>{{KEYS._session_back_home}}</div>
              <shuttle-errors direction="R"></shuttle-errors>
            </div>
            @for (shR of shuttles$|async|shuttleType:'R'; track $index) {
              <shuttle-editor [shuttle]="shR"></shuttle-editor>
            }
          </div>
        </div>
      </div>

      <!-- daily chat -->
       <daily-chat></daily-chat>
    }
  } @else if (manager.isEmpty$|async) {
    <div class="empty-container click-content" (click)="goToConfiguration()">configure session...</div>
  } @else {
    <div class="empty-container">no shuttle on this day</div>
  }
  <div class="bottom-fixed click-content full-width text-align-center margin-bottom-2"
       (click)="goToConfiguration()" spb-i18n>{{KEYS._session_configure}}</div>
</div>
