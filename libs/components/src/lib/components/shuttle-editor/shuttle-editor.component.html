@if (shuttle$|async; as shuttle) {
  <div class="shuttle-container"
       [class.temporary]="shuttle._temporary"
       [ngClass]="'shuttle-direction-'+shuttle.direction"
       fxLayout="column" fxFlex>

    <div class="shuttle-title" fxLayout="row" fxLayoutAlign="start center">
      <span fxFlex>{{shuttle.target}} {{shuttle.time|timeToString}}</span>
      @if (!shuttle._temporary) {
        <mat-icon class="as-button" (click)="deleteShuttle()">delete</mat-icon>
      }
    </div>

    <!-- DRIVER & PASSENGERS -->
    <div class="shuttle-passengers spb-color-hover">

      <!-- DRIVER -->
      <div class="shuttle-passengers-toolbar line-bottom"
           fxLayout="row" fxLayoutAlign="start center">

        <div class="shuttle-driver"
             fxLayout="row" fxLayoutAlign="start center"
             [matMenuTriggerFor]="personsMenu"
             #menuTrigger="matMenuTrigger"
             (click)="openPersonsMenu(menuTrigger, true)"
             fxFlex>
          <mat-icon class="as-button margin-right">sports_motorsports</mat-icon>
          @if (shuttle.driver) {
            <span fxFlex>{{shuttle.driver|personName:manager.session}}</span>
          } @else {
            <span class="disabled" fxFlex>no driver yet</span>
          }
        </div>
        <mat-icon class="as-button margin-right-2"
                  [class.disabled]="(shuttle.passengers||[]).length<1"
                  (click)="editTimes()">schedule</mat-icon>
        <mat-icon class="as-button"
                  [matMenuTriggerFor]="personsMenu"
                  #menuPassengersTrigger="matMenuTrigger"
                  (click)="openPersonsMenu(menuPassengersTrigger, false)"
        >add</mat-icon>
      </div>

      <!-- PASSENGERS -->
      <div class="shuttle-passengers-container">
        @for (psg of shuttle.passengers; track $index) {
          <div class="shuttle-passenger-row spb-color-hover"
               fxLayout="row" fxLayoutAlign="start center">
            <span fxFlex>{{psg|personName:manager.session}}</span>
            <span class="atl-time margin-right-2">{{psg|passengerTime:shuttle}}</span>
            <mat-icon class="as-button" (click)="removeShuttlePassenger(psg)">close</mat-icon>
          </div>
        }
      </div>

    </div>
  </div>
  <mat-menu #personsMenu="matMenu">
    @for (prs of menuPersons$|async; track $index) {
      <button mat-menu-item
              (click)="addPerson(prs)">
        <mat-icon>{{prs|personIcon}}</mat-icon>
        <span class="menu-parson-name">{{prs.name}}</span>
        @if (!(asDriver$|async)) {
          <span class="menu-passenger-group">{{prs.group|groupName:manager.session}}</span>
        }
      </button>
    }
  </mat-menu>
}
